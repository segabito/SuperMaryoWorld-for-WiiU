<!-- 
#  Javascript Virtual Machine
#  Copyright 2004- Kunio Makimoto <kunio@makimo.to>
#  
#  http://makimo.to/
# 
-->
<html>
<head><title>Javascript Virtual Machine  Stageloader </title>
<meta http-equiv="Content-type" content="text/html; charset=Shift_JIS">
<script>
<!--
var NEXTFLAG=false;
  if((location.hash+"") != "")NEXTFLAG=true;


var LOADER=false;
var CPU,SCR1,SCR2;
 var SCREEN_X= 512;// * 3 / 4;
 var SCREEN_Y= 448;// * 3 / 4;

	//スタート地点
 var PLSTART_X  = 0;//32*6-12;
 var PLSTART_Y  = 0;
	// 開始時の顔の向き (1= 左 2=右)
 var PLSTART_HFACE= 1; // 開始時のモーション "DOKAN_UP_OUT" "DOKAN_DOWN_OUT" "DOKAN_LEFT_OUT" "DOKAN_RIGHT_OUT"
 var PLSTART_ANIME="DOKAN_UP_OUT"; // var PLSTART_ANIME="DOKAN_UP_OUT"; 
	//途中から復活の場合の開始地点
 var PLSTART_X2 = -1;
 var PLSTART_Y2 = -1;
 var PLSTART_HFACE2= 1; 
 var PLSTART_ANIME2=""; 


 var WARPSTART_X=Array();
 var WARPSTART_Y=Array();
 var WARPSTART_HFACE=Array();
 var WARPSTART_ANIME=Array();

	// 土管などのワープからの開始点(配列)
 WARPSTART_X[0]=32*6-12;
 WARPSTART_Y[0]=32*10;
 WARPSTART_HFACE[0]=1;
 WARPSTART_ANIME[0]="DOKAN_UP_OUT";


	// メイン画面の背景色
 var SCREENBGCOLOR  = "#330000";//"#333333";
	// 上下枠の背景色
 var SCREENBGCOLOR2 = "#333366";

	//ボーナスゾーンなどでタイムを引き継ぐ場合は-1とする
 var GAMETIMER=100;
  if(NEXTFLAG)GAMETIMER = -1;

	// それぞれの方向へのスクロールを許可するかどうか
 var LEFTSCROLL =!true;
 var RIGHTSCROLL=true;
 var UPSCROLL   =!true;
 var DOWNSCROLL =!true;

	// 開始までのプレイヤー残数表示時間。
	// ボーナスゾーンなど、すぐに開始したい場合はゼロにする
 var firstWaitTime=1000;
// firstWaitTime=0;
	// 開始時の画面切替えエフェクト(IEのみ)
// var stageInitTrans="progid:DXImageTransform.Microsoft.pixelate(duration=1,maxsquare=50)";
 var stageInitTrans="progid:DXImageTransform.Microsoft.stretch(duration=2,style=spin)";

 var STAGEMODE= "FIELD"; // FIELD WATER
 var GAMEMODE = "PLAY"; // PLAY AUTOPLAY REPLAY

 // border:Xpxと指定したブロックがあると、その太さだけ
 // 縦方向に加算されてしまうので、引いておく。
 // charTable内でborderを使用しないなら 0
 var MozillaTableBoarderFix=0;

 var infotable1='';
 var infotable2='';

if(parent){
	CPU  = parent.cpu.window;
	SCR1 = parent.screen1.window;
	SCR2 = parent.screen2.window;
	SCREEN_X_OLD=parent.SCREEN_X;
	SCREEN_Y_OLD=parent.SCREEN_Y;

stage = Array(
"       4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 8 9 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4",
"             4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4       1 1 1       8 9         4 4 4 4 4 4 4 4 4 4 4                                     4",
" 4 4               4 4 4 4 4 4 4 4 4 4 4 4 4       1 1 1       8 9         4 4 4 4 4 4 4 4 4                                         4",
" 4 4 4                 4 4 4 4 4 4 4 4 4 4 4       1 1 1       8 9         4 4 4 4 4 4 4 4                                           4",
" 4 4 4 4    df           4 4 4 4 4 4 4 4 4 4       1 1 1       8 9 1 1 1   4 4 4 4 4 4 4                                             4",
" 4 4 4 4 4 4 4             4 4 4 4 4 4 4 4 4                   a b     4   4 4 4 4 4                                                 4",
" 4 4 4 4 4 4 4 4 4 4         4 4 4 4 4 4 4 4                  f1  a    4                                                             4",
" 4 4 4 4 4 4 4 4 4 4 4                   4 4                           4f0                                                           4",
" 4 4 4 4 4 4 4 4 4                       4 4                           4 4 4                                                         4",
" 4 4 4 4 4 4 4 4 4                       4 4 511 5 5 5 5c0 5 5 5 5 5 5 5 4 4 4 4                                                     4",
" 4 4 4 4 4 4 4 4 4                                                               4 4                                                 4",
" 4 4 4 4 4 4 4 4 4  e8                                                             4 4                    83838383                   4",
" 4 4 4 4 4 4 4 4 451515151515151515151515151515151515151515151515151515151515151515151 4 4    df  7f  d1  808 8 8                    4",
" 4 4 4 4 4 4 4 4 45 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5  4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4",

"");
charTable=Array(
//00
'',
//01
'img/block1G.gif',
//02
'img/block2G.gif',
//03
'img/block3.gif',
//04
'img/block5G.gif',
//05
'img/block6.gif',
//06
'img/coinA.gif',
//07
'',
//8
'img/dokanVL-G.gif',
//9
'img/dokanVR-G.gif',
//a
'img/dokanVHL-G.gif',
//b
'img/dokanVHR-G.gif',
//c
'img/dokanHU-G.gif',
//d
'img/dokanHD-G.gif',
//e
'img/dokanHHU-G.gif',
//f
'img/dokanHHD-G.gif',

//10
'img/hatenaA.gif',
//'<div style="border:1px outset silver;width:100%;height:100%;text-align:center;vertical-align:middle;margin:0;padding:0;background:gray;">＄</div>',
//11
'img/hatenaA.gif',
//12
'img/hatenaA.gif',
//13
'img/hatenaA.gif',

//14
'',
//15
'img/block1G.gif',
//16 17 18 19 1a 1b 1c 1d 1e 1f
  '','','','','','','','','','',
//20
'img/block1G.gif',
//21
'img/block1G.gif',
//22
'img/block1G.gif',
//23
'img/block1G.gif',
//24
'img/block1G.gif',
//25
'img/block1G.gif',

//26 27 28 29 2a 2b 2c 2d 2e 2f
  '','','','','','','','','','',
//30
'',
//31
'',
//32
'',
//33
'',
//34
'',
//35
'',
//36 37 38 39 3a 3b 3c 3d 3e 3f
  '','','','','','','','','','',
//40 背景用(当たり判定あり)
'img/grnfloorL.gif',
//41 背景用(当たり判定あり)
'img/grnfloor.gif',
//42 背景用(当たり判定あり)
'img/grnfloorR.gif',
//43
'img/grnfloorR.gif',
//44
'',
//45
'',
//46 47 48 49 4a 4b 4c 4d 4e 4f
'',
//47
'',
//48
'',
//49
'',
//4a
'',
//4b
'',
//4c
'img/dokanDR-G.gif',
//4d
'img/dokanLD-G.gif',
//4e
'img/dokanUR-G.gif',
//4f
'img/dokanLU-G.gif',

//50 背景用(当たり判定なし)
'img/akakage.gif',
//51 背景用(当たり判定なし)
'img/magma.gif',

'',
'',
'',
'',
'');

charTable[0x6e]='img/bar.gif';
charTable[0x6d]='img/ball.gif';
charTable[0xcc]='<div style="background:white;width:100%;height:100%;"></div>';


 for(var i=0;i<stage.length;i++)stage[i]=stage[i].replace(/[ ]/gi,"0").replace(/[^0-9^a-f]/gi,"");
  parent.stage=stage;
  parent.charTable=charTable;
}
 for(var i=1;i<256;i++)if(!charTable[i])charTable[i]="";


// イベント属性ブロックに触れた時にコールされる
function eventPointBlock(obj,win,block){
 with(win){
  switch(block){
  }
	return -1;
 }
} //

//ブロックを叩いた時にコールされる
function eventUpperBlock(obj,win,block){
 with(win){
  switch(block){
  }
	return -1;
 }
} //

// ゴールポイントに触れた時にコールされる
function eventGoalBlock(obj,win,block){
 with(win){
  switch(block){
  }
  stageClear();
	return -1;
 }
} //

// ワープポイントに触れた時にコールされる
function eventWarpBlock(obj,win,block,WARPPTR){
 with(win){
//		parent.backToLastStage(1);
		parent.stageChange("stage8-4.html");
	return -1;
 }
} //

// プレイヤーが落下した時にコールされる
function eventPlayerDrop(obj,win){
 with(win){
	return 1;
 }
} //


function screen1BeforeInit(){ // screen1 のロード直後に呼ばれる
 SCR1.SCREEN_X=SCREEN_X;
 SCR1.SCREEN_Y=SCREEN_Y;
	if(document.all && firstWaitTime > 300){
		var sdb=SCR1.document.body;
		if(stageInitTrans !=""){
		 sdb.style.filter=stageInitTrans;
		 sdb.filters[0].Apply();
		}
	}
} //
function screen1Init(){ // screen1 のロード終了後に呼ばれる

 var sdb=SCR1.document.body;
	sdb.style.background=SCREENBGCOLOR;
	document.body.style.background=
	SCREENBGCOLOR2;


 if(parent.warpFlag){
	var wp=parent.warpNum;
	SCR1.PL1START_X = WARPSTART_X[wp];
	SCR1.PL1START_Y = WARPSTART_Y[wp];
	SCR1.PL1START_HFACE=WARPSTART_HFACE[wp];
	SCR1.PL1START_ANIME=WARPSTART_ANIME[wp];
 }else
 if(parent.retryFlag){
	SCR1.PL1START_X = PLSTART_X2;
	SCR1.PL1START_Y = PLSTART_Y2;
	SCR1.PL1START_HFACE=PLSTART_HFACE2;
	SCR1.PL1START_ANIME=PLSTART_ANIME2;
 }

	SCR1.firstWaitTime=firstWaitTime;
	if(document.all){
		if(stageInitTrans !="" && firstWaitTime>300){
		 sdb.filters[0].duration=Math.abs((firstWaitTime*.7-parent.RATE_DRAW_FAST)/1000);
		}
	}


} // 

function screen1BeforeUnload(){ // screen1 のアンロード時に呼ばれる

} // 

function screen2BeforeInit(){ // screen2 のロード直後に呼ばれる
	SCR2.document.body.style.background=SCREENBGCOLOR2;
} //
function screen2Init(){ // screen2 のロード終了後に呼ばれる
} // 
function screen2BeforeUnload(){ // screen2 のロード終了後に呼ばれる
} // 



function cpuBeforeInit(){ // CPU のロード直後に呼ばれる

} // 
function cpuInit(){ // CPU のロード終了後に呼ばれる
	SCR1.onCpuInit();
 var msg=SCR1.document.getElementById("MSGAREA");
 msg.innerHTML=	
 				'<table style="color:white;font-size:80%;"><tr><td style="text-align:left;"><pre>'+
//	 			'                                 /＼\n'+
	 			'「たすかりました。ありがとう」（^Д^*)\n\n'+
//	 			'                             ⊂(   ⊂ )＞  \n'+
//	 			'  ∧己∧                       (     ﾉ)＞  \n'+
//	 			'（;´∀｀）「  …。 」         (__(__)`'+
	 			'（;´∀｀）「  …。 」'+
	 			'</pre></td></tr></table>'.replace(/ /g,"&nbsp");
} // 


function cpuBeforeUnload(){ // CPU のアンロード時に呼ばれる

} // 

function onCPUTimer(win,P1,tm){ // CPUのタイマーイベントごとに呼ばれる
 with(win){
//	WIN.SCROLL_LEFT+=1; //強制スクロールなど
 }
} //



function init(){
	LOADER=true;
	parent.LOADEROK=true;
	infotable1=document.getElementById('infotable1').innerHTML;
	infotable2=document.getElementById('infotable2').innerHTML;
	SCR1.location.replace("screen1.html");
	SCR2.location.replace("screen2.html");
	parent.ff();
} //

function bye(){

/*
	CPU.location.replace("blank.html");
	SCR1.location.replace("blank.html");
	SCR2.location.replace("blank.html");
*/
} //

onload=init;
onunload=bye;


function prkamezo(win,x,y){
 with(win){
	var xx=parseInt(x/BGBLOCKSIZE_X)*BGBLOCKSIZE_X;
	var yy=parseInt(y/BGBLOCKSIZE_Y)*BGBLOCKSIZE_Y;
	var world=getWorldNumber();
	var w=64,h=72;
	var img="img/kamezoL.gif";
	BackgroundObject(img,xx,yy-h+2+ BGBLOCKSIZE_Y,w,h,1500);

	var fontsize=dbHeight/30;
	backgroundObjectHTML('<div id="MSGAREA" style="text-align:center;font-size:'+fontsize+'px;letter-spacing:3;bor der:1px solid white" align="center";></div>',
				xx-BGBLOCKSIZE_X*2,yy-BGBLOCKSIZE_Y*6,BGBLOCKSIZE_X*6,BGBLOCKSIZE_Y*4,1500);
 }
} //

// オブジェクト作成例外
function createObject(win,group,x,y,num,option,obj){
 with(win){
	var tmp;
  switch(num){
	case 0xc5:
		tmp = new Firebar(obj,"normal",x,y,1);
		 tmp.rotate=0;
		 tmp.entry(group);
		tmp = new Firebar(obj,"normal",x,y,1);
		 tmp.rotate=90;
		 tmp.entry(group);
		tmp = new Firebar(obj,"normal",x,y,1);
		 tmp.rotate=180;
		 tmp.entry(group);
		tmp = new Firebar(obj,"normal",x,y,1);
		 tmp.rotate=270;
		return tmp.entry(group);
	break;
	case 0xa0:
		tmp= new Kamezo(obj,EnemyCode.Kamezo,x,y,option);
		tmp.hammerFlag = true;
		tmp.life	   *= 2;
		tmp.hammerRate /= 2;
		tmp.jumpRate *= 2;
		tmp.fireReach = 1;
//		tmp.face="img/pinch";
//		tmp.imgWalk="img/pinch";
//		tmp.imgFire="img/pinch";
		tmp.imgDie="img/pinchL.gif";
		tmp.charBodyWidth  *= 1.5;	//当たり判定サイズ
		tmp.charBodyHeight *= 1.5;
		tmp.charSpriteWidth  *= 1.5; //グラフィックのサイズ
		tmp.charSpriteHeight *= 1.5;
		tmp.cSprX *= 1.5;
		tmp.cSprY *= 1.5;
		tmp.xAccel *= 1.5;
		return tmp.entry(group);
	break;
	case 0xd1:
		prkamezo(win,x,y);
	break;
	case 0xdf:
	 var img="img/PL2standR.gif";
	 var w=32,h=32;
	 BackgroundObject(img,x,y,w,h,50);
	 setXYpointObject(x,y,0);
	break;
  }
 }
} //


-->
</script>
</head>
<body bgcolor="black" onfocus="parent.cpu.focus();">
<span style="background:#888888;color:black">ダッシュ-[CTRL] ジャンプ-[SHIFT]</span>

<span id="infotable1" style="display:none;">
決　戦
</span>
<span id="infotable2" style="display:none;">
</span>

</body>
</html>